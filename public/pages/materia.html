<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mat√©ria | Revista do Empreendedor Jovem</title>

    <link rel="stylesheet" href="/css/style.css" />
    <meta
      name="description"
      content="Revista do Empreendedor Jovem ‚Äî not√≠cias sobre tecnologia, economia, empreendedorismo, bolsas e cursos."
    />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="Davi H. do Amaral" />

    <!-- Favicon -->
    <link rel="icon" href="/favicon/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" />
    <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/favicon/site.webmanifest" />
    <meta name="theme-color" content="#ffffff" />

    <style>
      .materia-wrap { max-width: 900px; margin: 24px auto; padding: 0 16px; }
      .materia-top { display:flex; justify-content:space-between; align-items:baseline; gap:16px; margin-bottom: 12px; }
      .materia-top a { color: inherit; text-decoration: none; }
      .materia-top a:hover { text-decoration: underline; }

      .meta { color:#666; font-size:14px; margin:8px 0 14px; text-transform:capitalize; }
      .hero { width:100%; max-height:380px; object-fit:cover; border:1px solid #ddd; margin:14px 0 18px; }
      .titulo { margin:10px 0 8px; font-size:34px; line-height:1.1; }
      .resumo { font-size:18px; color:#222; margin:0 0 10px; }
      .conteudo { font-size:18px; line-height:1.7; color:#111; white-space:pre-wrap; }
      .status { margin-top:18px; color:#b00020; }
      .muted { color:#666; }
      .hr { border:none; border-top:1px solid #ddd; margin:18px 0; }

      /* An√∫ncios */
      .ad-slot { border:1px solid #ddd; background:#fff; padding:12px; margin:16px 0 18px; }
      .ad-label { font-size:12px; color:#666; text-transform:uppercase; letter-spacing:.4px; margin-bottom:8px; }
      .ad-box { display:block; text-decoration:none; color:inherit; border:1px dashed #bbb; padding:14px; text-align:center; }
      .ad-title { font-weight:700; margin-bottom:6px; }
      .ad-text { color:#444; font-size:14px; }
    </style>
  </head>

  <body>
    <div class="materia-wrap">
      <div class="materia-top">
        <a href="/" class="muted">‚Üê Voltar para a Home</a>
        <span class="muted" id="now"></span>
      </div>

      <article id="materia">
        <p class="muted">Carregando mat√©ria...</p>
      </article>

      <p id="status" class="status"></p>
    </div>

    <script>
      const materiaEl = document.getElementById("materia");
      const statusEl = document.getElementById("status");
      const nowEl = document.getElementById("now");

      function escapeHtml(str) {
        return String(str ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function formatDate(iso) {
        if (!iso) return "";
        const d = new Date(iso);
        return d.toLocaleString("pt-BR", {
          day: "2-digit",
          month: "long",
          year: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function getIdFromUrl() {
        const url = new URL(window.location.href);
        const idStr = url.searchParams.get("id");
        const id = Number(idStr);
        return Number.isInteger(id) ? id : null;
      }

      async function carregar() {
        if (nowEl) {
          const now = new Date();
          nowEl.textContent = now.toLocaleDateString("pt-BR", {
            weekday: "long",
            day: "2-digit",
            month: "long",
            year: "numeric",
          });
        }

        const id = getIdFromUrl();
        if (!id) {
          materiaEl.innerHTML =
            '<p>URL inv√°lida. Falta o par√¢metro <strong>?id=</strong>.</p>';
          return;
        }

        try {
          // üî• Sem API_BASE -> sem CORS
          const res = await fetch(`/api/noticias/${id}`, {
            headers: { "Accept": "application/json" }
          });

          const noticia = await res.json().catch(() => null);

          if (!res.ok || !noticia) {
            statusEl.textContent = (noticia && noticia.error) ? noticia.error : "Erro ao carregar a mat√©ria.";
            materiaEl.innerHTML = "<p>N√£o foi poss√≠vel carregar a mat√©ria.</p>";
            return;
          }

          const titulo = escapeHtml(noticia.titulo);
          const resumo = escapeHtml(noticia.resumo);
          const conteudo = escapeHtml(noticia.conteudo);
          const categoria = escapeHtml(noticia.categoria);
          const dt = escapeHtml(formatDate(noticia.created_at));

          document.title = `${titulo} | Revista do Empreendedor Jovem`;
          const metaDesc = document.querySelector('meta[name="description"]');
          if (metaDesc) metaDesc.setAttribute("content", noticia.resumo || "");

          materiaEl.innerHTML = `
            <div class="meta">${categoria} ‚Ä¢ ${dt}</div>
            <h1 class="titulo">${titulo}</h1>
            <p class="resumo">${resumo}</p>

            <aside class="ad-slot">
              <div class="ad-label">Publicidade</div>
              <a class="ad-box" href="#" target="_blank" rel="noopener">
                <div class="ad-title">Anuncie aqui</div>
                <div class="ad-text">Sua marca pode aparecer neste espa√ßo</div>
              </a>
            </aside>

            ${noticia.imagem ? `<img class="hero" src="${noticia.imagem}" alt="">` : ""}

            <hr class="hr" />
            <div class="conteudo">${conteudo}</div>

            <aside class="ad-slot">
              <div class="ad-label">Publicidade</div>
              <a class="ad-box" href="https://wa.me/5581994602686?text=Quero%20exibir%20minha%20marca%20no%20website." target="_blank" rel="noopener">
                <div class="ad-title">Anuncie aqui</div>
                <div class="ad-text">Entre em contato para patrocinar conte√∫dos</div>
              </a>
            </aside>
          `;

          statusEl.textContent = "";
        } catch (e) {
          statusEl.textContent = "Falha de rede ao carregar a mat√©ria.";
          materiaEl.innerHTML = "<p>Erro ao carregar a mat√©ria.</p>";
        }
      }

      carregar();
    </script>
  </body>
</html>
